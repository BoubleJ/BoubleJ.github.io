---
date: "2024-07-18"
title: "[Node.JS] npm, package.json, node_modules"
categories: ["Node.JS"]
summary: "npm, package.json, node_modules을 알아봅시다."
thumbnail: "/image/npm아이콘.png"
---

# npm(Node Package Manager)이란?

노드 패키지(modules)를 관리하기 위한 매니저 시스템으로 다양한 패키지들을 설치, 업데이트, 삭제하는데 도움을 주는 툴입니다.

프로젝트에 필요한 라이브러리를 다운로드 또는 관리 할 수 있도록 해주는 역할을 합니다.

일반적으로 npm을 사용하게 되면 `package.json 파일`을 프로젝트 폴더 바로 아래에서 생성해 모듈과 해당 모듈의 버전을 관리합니다.

![package](/image/package.png)

위 이미지처럼 프로젝트 루트 디렉토리 내 `package.json`을 통해 프로젝트에 설치된 라이브러리 및 모듈들을 관리하는 것이죠.

<br>
터미널에

```shell
npm init
```

를 입력하면 `package.json 파일`이 생성됩니다.

사실 요즘은 CLI(`Vite`나 `CRA` 등)를 통해서 프로젝트를 생성하게 되면 기본적으로 함께 포함되어 생성되기 때문에 위 명령어를 사용할 일은 많이 없을겁니다.

<br>
<br>

## npm install (npm i)이란?

프로젝트 내 필요한 모듈 및 패키지를 설치하는데 사용하는 명령어입니다.

크게 2가지 방식으로 사용됩니다.

### 1. 특정 패키지 설치

```shell
npm install <패키지 이름 및 사양>
```

특정 패키지를 설치할 경우 위 형식으로 사용하면 됩니다.

대부분의 자바스크립트 프로그램은 npm안에 등록되어있습니다.
때문에 개발자가 필요로하는 패키지가 있다면 위 명령어를 통해 npm에서 해당 패키지 or 라이브러리 등을 설치할 수 있습니다.

ex.

```shell
npm install redux
```

redux 라이브러리를 설치하는 명령어입니다.

<br>

### 2. 프로젝트가 의존하고 있는 모든 패키지 설치

```shell
npm install
```

특정 패키지 명을 명시하지 않았을 경우 `package.json` 에 명시되어있는 모든 의존패키지를 설치해 `node_modules`에 적재합니다.

이 외에도 수많은 명령어가 있습니다. [공식문서](https://docs.npmjs.com/cli/v8/commands/npm-install)를 참고하시면 좋을 것 같습니다.

<br>

참고로 패키지를 삭제하는 명령어는 다음과 같습니다.

```shell
npm uninstall 패키지 이름
```

> npm install의 줄임말? 이 npm i 입니다. 똑같은 명령어입니다.

<br>
<br>

# package.json

package.json은 생성한 프로젝트의 메타정보와 프로젝트가 의존하고 있는 모듈들에 대한 정보들을 json 형태로 모아놓은 파일입니다.

```json
{
  "name": "my-gatsby-site",
  "version": "1.0.0",
  "private": true,
  "description": "my-gatsby-site",
  "author": "내이름",
  "keywords": ["gatsby"],
  "scripts": {
    "deploy": "gatsby build && gh-pages -d public -b gh-pages",
    "develop": "gatsby develop",
    "start": "gatsby develop",
    "build": "gatsby build",
    "create": "gatsby-post-gen",
    "serve": "gatsby serve",
    "clean": "gatsby clean"
  },
  "dependencies": {
    "@emotion/react": "^11.11.4",
    "@emotion/styled": "^11.11.0",

    //생략

    "highlight.js": "^11.9.0",
    "material-ui-popup-state": "^5.0.10",
    "prism-react-renderer": "^2.3.1",
    "query-string": "^9.0.0",
    "react": "^18.2.0",
    "react-bootstrap": "^2.8.0",
    "react-dom": "^18.2.0",
    "react-icons": "^4.12.0",
    "react-typography": "^0.16.23",
    "styled-components": "^6.1.8",
    "tw-elements-react": "^1.0.0-alpha2",
    "typescript": "^5.4.2",
    "typography": "^0.16.24",
    "typography-theme-fairy-gates": "^0.16.19"
  },
  "devDependencies": {
    "gatsby-plugin-postcss": "^6.12.0",
    "gatsby-post-gen": "^1.0.0"
  }
}
```

제 기술 블로그 `package.json` 파일입니다. 매우 복잡하죠? 간략하게 살펴보면 `scripts`영역은 명령어, `dependencies`의존성, `devDependencies` 개발모드 의존성 등 으로 구성되어있네요.

`"dependencies"` 영역을 잠깐 살펴보면 타입스크립트, react-dom, emotion 등 다양한 모듈들이 포함되어있고 버전이 명시되어있습니다. 모듈들은 해당 프로젝트가 의존하는 모듈들입니다.

예를 들어

```json
 "typescript": "^5.4.2",
```

제 블로그는 타입스크립트 5.4.2 버전에 의존하고 있다는 뜻이죠. 여기서 의존한다는 말은 대충 사용하고있다 라고 이해하셔도 무방합니다. 물론 정확한 표현은 아닙니다.

> 참고로 위 ^ 기호는 버전 지정에 사용되며, "호환되는 버전"을 의미합니다. <br> ^ 기호가 붙은 버전은 설치 시 해당 버전 이상이면서 같은 메이저 버전 범위 내의 가장 최신 버전을 설치하도록 npm에 지시합니다. <br> 예를 들어, ^1.2.3은 1.2.3 이상 2.0.0 미만의 가장 최신 버전을 설치하라는 의미입니다.

<br>

## npm i 명령어 활용

```shell
npm install
```

위에 언급한 `npm install` 명령어를 사용하면 `package.json`에 명시된 의존성 패키지들을 프로젝트에 모두 설치해줍니다.

팀 내에서 동일한 개발환경을 구축하려고 할 경우, package.json을 통해 동일한 개발환경을 빠르게 구축할 수 있습니다.

<br>

예를 들어

a라는 사람이 만든 프로젝트를 b라는 사람이 수정보완할 경우 a와 b의 개별환경이 다르기 때문에 b는 정상적으로 작업을 수행할 수 없습니다.

이때 b는 a가 제작한 프로젝트 git 리포지토리를 받아온 후 `npm install` 명령어를 실행하면 `package.json` 내 의존성 환경이 구축되므로 정상적으로 작업을 수행할 수 있습니다.

> package.json 파일을 사용하지 않을 경우 여러 문제가 발생할 수 있습니다. <br> 프로젝트에서 사용하는 외부 모듈들이 많아지게 되면 관리하기 어려워지고, 패키지들의 버전관리가 어려워집니다. <br> 또한, 새로운 프로젝트를 진행할 경우, 필요한 모듈들이 많다면 매번 npm 명령으로 설치해야하는 번거로움이 존재합니다. <br> 사실상 개발한다면 package파일은 반드시 필요하다보면 됩니다.



<br>
<br>

그럼 package파일 내 dependencies와 devDependencies의 차이점은 뭘까요??

<br>

## dependencies와 devDependencies 차이점

**dependencies**에는 애플리케이션 동작과 직접적으로 연관된 라이브러리를 설치하고 **devDependencies**에는 개발할 때 필요한 라이브러리를 설치합니다.

프로젝트 내 라이브러리를 사용하는 경우 개발모드에서만 사용하는 모듈이 있는가하면 개발 + 배포 시 모두 사용하는 모듈이 존재합니다.

개발모드에서만 사용하는 라이브러리의 경우 굳이 배포과정에서 필요하지 않으니 **devDependencies**에 설치해 구분함으로써 빌드시간을 줄이고, 배포할 때 불필요한 라이브러리를 포함시키지 않도록 하는 것이죠.

### 설치방법

devDependencies 설치 시

```shell
npm install 라이브러리명 --save-dev
npm install 라이브러리명 -D
```

dependencies 설치 시

```shell
npm install 라이브러리명
```

다음과 같이 구분해 사용하면 됩니다.

<br>
<br>

# node_modules란?

npm을 통해 프로젝트를 생성하게 되면, node_modules라는 디렉토리가 생성됩니다.

package.json에는 현 프로젝트가 의존하고 있는 모듈들에 대한 정보가 명시되어있고, node_modules 디렉토리 안에는 package.json에 있는 모듈과, 그 모듈들이 의존하고 있는 모든 모듈들을 포함하고 있습니다. 

예를 들어
```json
//package.json

 "typescript": "^5.4.2",
```

다음과 같이 명시되어있다면 node_modules내부에는 typescript 5.4.2 버전에 대한 의존성 모듈들이 설치되어있습니다.

때문에 node_modules 디렉토리 안에는 모듈들의 의존성에 의해 정말 수많은 많은 모듈들이 포함되어 있습니다. 

npm으로 새로운 모듈을 설치하게 되면 자동으로 package.json과 node_modules에 추가됩니다.

워낙 많은 모듈들이 포함되어 있기에 `node_modules 폴더`는 용량이 매우 큽니다. 때문에 git에 커밋할 경우, node_modules는 제외해 올리곤 합니다. node_modules가 없어도 package.json에 설치한 패키지들의 정보가 모여있기 때문에, 다른 개발자가 npm install 명령어로 node_modules를 언제든지 추가할 수 있기 때문이지요. 

<br>
<br>

# package-lock.json이란?
package-lock.json 파일은 npm을 사용해서 node_modules 트리나 package.json 파일을 수정하게 되면 자동으로 생성되는 파일입니다.
이 파일은 파일이 생성되는 시점의 의존성 트리에 대한 **정확한 정보**를 가지고 있습니다.

의존성 트리는 package.json에 등록된 모듈과 그 모듈들이 의존하고 있는 모든 모듈을 포함하고 있기 때문에, 결국 package-lock.json도 이 모든 모듈들의 정보를 가지고 있습니다.

때문에 npm을 사용해서 node_modules나 package.json을 수정하게 되면, package-lock.json도 자동으로 업데이트 됩니다.

<br>

package.json 파일에는 의존성 모듈(dependencies)의 `version range`가 사용됩니다.

`version range`란, 특정 버전이 아닌 `버전의 범위`를 말합니다. 

예를 들어서 npm install express 로 `익스프레스`를 설치하면, package.json에는 `'^4.10.3'` 이런 식으로 버전 범위가 추가되게 된다. 

이 버전의 익스프레스가 추가된 package.json을 가지고 npm install 을 하게되면 4.10.3 버전이 설치되지만, 익스프레스의 버전이 업데이트된 후에 동일한 package.json 파일 정보를 가지고 npm install 을 하게되면 4.10.3 버전이 아닌 새로 업데이트된 버전으로 익스프레스가 변경됩니다. 

이럴 경우에 기존에 가지고 있던 node_modules에 있던 모듈의 버전과 충돌이 일어나, 오류를 발생 시킬 수 있습니다. 

이 문제를 해결하기 위해 package-lock.json을 사용합니다.

<br>

`package-lock.json`은 `node_modules`에 대한 정보를 가지고 있는데, `package-lock.json`이 업데이트되는 시점에 `node_modules`를 재생성할 수 있습니다. 

그래서 package-lock.json 파일이 있다면, npm install로 `package.json`, `package-lock.json`에 있는 모듈들이 새로 업데이트 되는 동시에, node_modules가 새로 생성되어, 각 파일이 가지고 있는 모듈의 버전을 동일하게 맞출 수 있게 되는 것이죠.

<br>

package-lock.json에 모든 모듈의 버전은 npm install 을 수행하는 시점에 따라 달라지게 됩니다. 

npm install 을 수행하는 시점에 업데이트 되어있는 모듈의 버전으로 업데이트가 되고 이렇게 되면 package.json과 package-lock.json에 있는 모듈이 같은 버전으로 업데이트가 됩니다.

 이때 package-lock.json에 있는 모듈 정보 때문에 node_modules가 재생성되어, 3개의 파일에 있는 모듈이 모두 같은 버전으로 맞춰지게 되어 정상적으로 프로그램이 동작하게 됩니다.

이러한 이유로 node_modules는 git에 커밋할 경우 빠질 수 있는 파일이지만, package.json과 package-lock.json은 반드시 같이 커밋해야한다. 같이 커밋하지 않으면 버전 오류가 발생할 수 있기 때문이지요.


<br>
<br>

# npm ci 명령어란?

여기서 ci란 `clean install` 이란 뜻으로 `package-lock.json`에 명시되어있는 패키지 정보를 활용해 `완전 정확한` 버전의 패키지들을 설치해 `node_modules`에 적재합니다. 

따라서 해당 명령어로 패키지를 설치하는 모든 개발자들이 동일한 버전의 패키지를 사용하고 있음을 보장할 수 있습니다. 


### `npm ci` 의 작업과정은 다음과 같습니다. 

1. `node_modules` 폴더를 삭제하여 깨끗한 상태를 보장합니다.
2. `package-lock.json`에서 `정확한 버전`의 모든 종속성을 설치하고 `정확한 버전`의 패키지들을 `node_modules`에 적재합니다. 

<br>

`npm install`과는 달리 npm ci는 `package-lock.json`을 수정하지 않습니다. 그러나 프로젝트에 package-lock.json 파일이 있어야 한다.


package-lock.json 파일이 없으면 npm ci가 작동하지 않으므로 대신 npm install을 사용해야 package-lock.json 파일이 존재하도록 해야합니다.

npm ci를 사용하면 안정적인 빌드를 얻을 수 있다는 장점이 있습니다.

<br>

### 언제써요?

Jenkins 또는 GitLab CI와 같은 연속 통합 도구에서 실행할 때 유용합니다.

혹은 다른 개발자들과 함께 작업하는 프로젝트의 초기 설정을 진행할 때 `npm ci`를  통해 `package-lock.json` 기반 패키지를 설치하는 경우 사용합니다. 


<br>
<br>
<br>

# 정리

**node_modules**

실제로 설치된 의존성 모듈들이 모두 들어있는 디렉토리. 애플리케이션이 사용할 코드는 여기서 가져다 씁니다.

**package.json**

npm istall 을 할 때 기준이 되어주는 파일. `대략적인 의존성 버전`을 관리합니다.

**package-lock.json**

프로젝트에 설치되어야하는 의존성의 `정확한 버전`을 관리해주는 파일. 

`package.json`을 보면 `^4.10.3`과 같은 버전의 대략적인 범위를 보여주는 반면 `package-lock.json`은 `구체적인 버전명`이 명시되어 있습니다. 프로젝트가 동일한 의존성을 가질 수 있도록 하는 역할을 합니다.

<br>
<br>
<br>

<details>

<summary>참고문헌</summary>

<div markdown="1">

https://velog.io/@dongjun187/package.json-nodemodules-package-lock.json-%EB%8A%94-%EB%AD%98%EA%B9%8C


https://doqtqu.tistory.com/353


https://handhand.tistory.com/274

https://hyunjun19.github.io/2018/03/23/package-lock-why-need/

https://www.codeit.kr/community/questions/UXVlc3Rpb246NjBlNmQwN2I2ZjU1NDAxYWEyNzAyYjE1

</div>

</details>
